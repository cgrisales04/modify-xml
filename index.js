let xmlStr = `<?xml version=\"1.0\" encoding=\"UTF-8\"?><Document><Header><HeaderField Key=\"PosId\">6</HeaderField><HeaderField Key=\"Alias\">Desde 1 Hasta 10000</HeaderField><HeaderField Key=\"SaleId\">d5d16509-28c0-4510-8ae3-2bd8bb856f22</HeaderField><HeaderField Key=\"Serie\">FCJE</HeaderField><HeaderField Key=\"Number\">6</HeaderField><HeaderField Key=\"DocumentTypeId\">27</HeaderField><HeaderField Key=\"Z\">1</HeaderField><HeaderField Key=\"Date\">11-02-2022</HeaderField><HeaderField Key=\"Time\">15:00:44</HeaderField><HeaderField Key=\"IsTaxIncluded\">true</HeaderField><HeaderField Key=\"IsClosed\">false</HeaderField><HeaderField Key=\"IsSubTotalized\">false</HeaderField><HeaderField Key=\"TaxesAmount\">0,0000</HeaderField><HeaderField Key=\"NetAmount\">46000,0000</HeaderField><HeaderField Key=\"ServiceTypeId\">0</HeaderField><HeaderField Key=\"LoyaltyCardNumber\"/><HeaderField Key=\"PrintCount\">0</HeaderField><HeaderField Key=\"BlockToPrint\">null</HeaderField><HeaderField Key=\"TicketToPrint\"/><HeaderField Key=\"Rounding\">0,0000</HeaderField><HeaderField Key=\"TaxExemption\"/><HeaderField Key=\"IsoDocumentId\"/><HeaderField Key=\"IsDemo\">false</HeaderField><HeaderField Key=\"DocumentAPIPromoData\"/><HeaderField Key=\"ControlCode\"/><HeaderField Key=\"PriceListId\">1</HeaderField><HeaderField Key=\"CurrencyISOCode\">COP</HeaderField><HeaderField Key=\"CurrencyExchangeRate\">1,0000</HeaderField><HeaderField Key=\"ResolutionNumber\">10320901521</HeaderField><HeaderField Key=\"ResolutionDate\">24-10-2022</HeaderField><HeaderField Key=\"ResolutionRank\">FCJE (Desde 1 Hasta 10000) </HeaderField><Serie><SerieField Key=\"SerieId\">49</SerieField><SerieField Key=\"Serie\">FCJE</SerieField><SerieField Key=\"ResolutionNumber\">10320901521</SerieField><SerieField Key=\"ResolutionDate\">10-24-2022</SerieField><SerieField Key=\"ExpirationDate\">01-01-2024</SerieField></Serie><CustomSerieFields/><Discount><DiscountField Key=\"DiscountReasonId\">0</DiscountField><DiscountField Key=\"Percentage\">0,0000</DiscountField><DiscountField Key=\"Amount\">0,0000</DiscountField><DiscountField Key=\"AmountWithTaxes\">0,0000</DiscountField></Discount><Company><CompanyField Key=\"FiscalId\">900248304</CompanyField><CompanyField Key=\"Name\">Websaas Developers</CompanyField><CompanyField Key=\"TradeName\">PRUEBAS WEBSAAS FE</CompanyField><CompanyField Key=\"FiscalName\">PRUEBAS WEBSAAS FE</CompanyField><CompanyField Key=\"CorrectTradeName\">Websaas Developers</CompanyField><CompanyField Key=\"Address\">Calle 19 No. 43 G 119 Oficina 802</CompanyField><CompanyField Key=\"PostalCode\">005001</CompanyField><CompanyField Key=\"City\">MEDELLIN</CompanyField><CompanyField Key=\"Phone\">3164809792</CompanyField><CompanyField Key=\"Email\">developers</CompanyField><CustomCompanyFields/></Company><Shop><ShopField Key=\"ShopId\">1</ShopField><ShopField Key=\"FiscalId\">900248304</ShopField><ShopField Key=\"Name\">Websaas Developers</ShopField><ShopField Key=\"TradeName\">PRUEBAS WEBSAAS FE</ShopField><ShopField Key=\"FiscalName\">PRUEBAS WEBSAAS FE</ShopField><ShopField Key=\"CorrectTradeName\">Websaas Developers</ShopField><ShopField Key=\"Address\">Calle 19 No. 43 G 119 Oficina 802</ShopField><ShopField Key=\"PostalCode\">005001</ShopField><ShopField Key=\"City\">MEDELLIN</ShopField><ShopField Key=\"State\">ANTIOQUIA</ShopField><ShopField Key=\"Phone\">3164809792</ShopField><ShopField Key=\"Email\">developers</ShopField><ShopField Key=\"DefaultPriceListId\">1</ShopField><ShopField Key=\"DefaultPriceListName\">Tarifa por defecto</ShopField><ShopField Key=\"MainCurrencyId\">1</ShopField><ShopField Key=\"MainCurrencyName\">Peso Colombiano</ShopField><ShopField Key=\"LanguageIsoCode\">es</ShopField><ShopField Key=\"CountryIsoCode\">COL</ShopField><ShopField Key=\"Web\"/><CustomShopFields/></Shop><Seller><SellerField Key=\"SellerId\">6</SellerField><SellerField Key=\"ContactType\">1</SellerField><SellerField Key=\"Gender\">2</SellerField><SellerField Key=\"FiscalIdDocType\">9</SellerField><SellerField Key=\"FiscalId\">12112222</SellerField><SellerField Key=\"Name\">Jenny</SellerField><SellerField Key=\"GivenName1\"/><SellerField Key=\"Address\">cra 65</SellerField><SellerField Key=\"PostalCode\">050001</SellerField><SellerField Key=\"City\">Medellin</SellerField><SellerField Key=\"State\"/><SellerField Key=\"Phone\">344444</SellerField><SellerField Key=\"Email\">jenny.molina@websaas.net</SellerField></Seller><Customer><CustomerField Key=\"customerId\">3</CustomerField><CustomerField Key=\"ContactType\">1</CustomerField><CustomerField Key=\"Gender\">1</CustomerField><CustomerField Key=\"FiscalIdDocType\">9</CustomerField><CustomerField Key=\"FiscalId\">1033650398</CustomerField><CustomerField Key=\"Name\">ANDRES RUEDA</CustomerField><CustomerField Key=\"Phone\">3117353447</CustomerField><CustomerField Key=\"Phone2\"/><CustomerField Key=\"Address\">cRA 65 52 1 1 6 615</CustomerField><CustomerField Key=\"PostalCode\">050001</CustomerField><CustomerField Key=\"CityId\">561</CustomerField><CustomerField Key=\"City\">MEDELLÍN</CustomerField><CustomerField Key=\"StateId\">1399</CustomerField><CustomerField Key=\"State\">ANTIOQUIA</CustomerField><CustomerField Key=\"Email\">andresrueda@websaas.net</CustomerField><CustomerField Key=\"IsTaxExempt\">false</CustomerField><CustomerField Key=\"TaxExemption\">0,0000</CustomerField><CustomerField Key=\"BillRegimeId\">0</CustomerField><CustomerField Key=\"ExemptTaxId\">0</CustomerField><CustomerField Key=\"CountryId\">53</CustomerField><CustomerField Key=\"Country\">COLOMBIA</CustomerField><CustomerField Key=\"CountryIso2\">CO</CustomerField><CustomerField Key=\"GenerateInvoice\">false</CustomerField><CustomerField Key=\"BirthDate\">08-03-1990</CustomerField><CustomCustomerFields><CustomCustomerField Key=\"CustomerId\"/><CustomCustomerField Key=\"Version\"/><CustomCustomerField Key=\"Regimen\"/><CustomCustomerField Key=\"Observacion\"/></CustomCustomerFields></Customer><Provider><ProviderField Key=\"providerId\">null</ProviderField></Provider></Header><Lines><Line><LineField Key=\"LineId\">d583428f-68fb-4327-97ba-c1bea99418ca</LineField><LineField Key=\"LineNumber\">1</LineField><LineField Key=\"ProductId\">2</LineField><LineField Key=\"ProductSizeId\">2</LineField><LineField Key=\"ExternalProductId\">0</LineField><LineField Key=\"Name\">Sopa o crema del día</LineField><LineField Key=\"Size\"/><LineField Key=\"Units\">1,0000</LineField><LineField Key=\"IsMenu\">false</LineField><LineField Key=\"IsGift\">false</LineField><LineField Key=\"PriceListId\">1</LineField><LineField Key=\"Price\">10000,0000</LineField><LineField Key=\"SellerId\">6</LineField><LineField Key=\"WarehouseId\">1</LineField><LineField Key=\"DiscountReasonId\">0</LineField><LineField Key=\"ReturnReasonId\">0</LineField><LineField Key=\"ReturnReasonName\"/><LineField Key=\"DiscountPercentage\">0,0000</LineField><LineField Key=\"DiscountAmount\">0,0000</LineField><LineField Key=\"BaseAmount\">10000,0000</LineField><LineField Key=\"TaxesAmount\">0,0000</LineField><LineField Key=\"TaxCategory\">0</LineField><LineField Key=\"NetAmount\">10000,0000</LineField><LineField Key=\"Measure\">1,0000</LineField><LineField Key=\"MeasureInitials\">uds</LineField><LineField Key=\"IsNew\">false</LineField><LineField Key=\"ProductReference\">1</LineField><LineField Key=\"ProductBarcode\"/><LineField Key=\"ServiceTypeId\">0</LineField><LineField Key=\"DestinationWarehouseId\">0</LineField><LineField Key=\"ReturnSaleSerie\"/><LineField Key=\"ReturnSaleNumber\"/><LineField Key=\"ReturnLineServiceTypeId\">0</LineField><LineField Key=\"ProductType\">Product</LineField><CustomProductFields/><LineTaxes><LineTax><LineTaxField Key=\"TaxId\">3</LineTaxField><LineTaxField Key=\"Position\">1</LineTaxField><LineTaxField Key=\"Percentage\">0,0000</LineTaxField><CustomTaxFields/></LineTax></LineTaxes></Line><Line><LineField Key=\"LineId\">f983cfe9-2da2-4c19-92a9-c1ca35cc0779</LineField><LineField Key=\"LineNumber\">2</LineField><LineField Key=\"ProductId\">13</LineField><LineField Key=\"ProductSizeId\">13</LineField><LineField Key=\"ExternalProductId\">0</LineField><LineField Key=\"Name\">De Nueva Zelanda rellenos a la Casa Solariega X6un</LineField><LineField Key=\"Size\"/><LineField Key=\"Units\">1,0000</LineField><LineField Key=\"IsMenu\">false</LineField><LineField Key=\"IsGift\">false</LineField><LineField Key=\"PriceListId\">1</LineField><LineField Key=\"Price\">36000,0000</LineField><LineField Key=\"SellerId\">6</LineField><LineField Key=\"WarehouseId\">1</LineField><LineField Key=\"DiscountReasonId\">0</LineField><LineField Key=\"ReturnReasonId\">0</LineField><LineField Key=\"ReturnReasonName\"/><LineField Key=\"DiscountPercentage\">0,0000</LineField><LineField Key=\"DiscountAmount\">0,0000</LineField><LineField Key=\"BaseAmount\">36000,0000</LineField><LineField Key=\"TaxesAmount\">0,0000</LineField><LineField Key=\"TaxCategory\">0</LineField><LineField Key=\"NetAmount\">36000,0000</LineField><LineField Key=\"Measure\">1,0000</LineField><LineField Key=\"MeasureInitials\">uds</LineField><LineField Key=\"IsNew\">false</LineField><LineField Key=\"ProductReference\">12</LineField><LineField Key=\"ProductBarcode\"/><LineField Key=\"ServiceTypeId\">0</LineField><LineField Key=\"DestinationWarehouseId\">0</LineField><LineField Key=\"ReturnSaleSerie\"/><LineField Key=\"ReturnSaleNumber\"/><LineField Key=\"ReturnLineServiceTypeId\">0</LineField><LineField Key=\"ProductType\">Product</LineField><CustomProductFields/><LineTaxes><LineTax><LineTaxField Key=\"TaxId\">3</LineTaxField><LineTaxField Key=\"Position\">1</LineTaxField><LineTaxField Key=\"Percentage\">0,0000</LineTaxField><CustomTaxFields/></LineTax></LineTaxes></Line></Lines><Taxes><Tax><TaxField Key=\"TaxId\">3</TaxField><TaxField Key=\"Description\">EXENTOS</TaxField><TaxField Key=\"LineNumber\">1</TaxField><TaxField Key=\"TaxBase\">46000,0000</TaxField><TaxField Key=\"Percentage\">0,0000</TaxField><TaxField Key=\"TaxAmount\">0,0000</TaxField><TaxField Key=\"FiscalId\"/><TaxField Key=\"ExemptReason\"/><TaxField Key=\"IsoCode\"/><CustomTaxFields/></Tax><Tax><TaxField Key=\"TaxId\">3</TaxField><TaxField Key=\"Description\">EXENTOS</TaxField><TaxField Key=\"LineNumber\">1</TaxField><TaxField Key=\"TaxBase\">86000,0000</TaxField><TaxField Key=\"Percentage\">0,0000</TaxField><TaxField Key=\"TaxAmount\">0,0000</TaxField><TaxField Key=\"FiscalId\"/><TaxField Key=\"ExemptReason\"/><TaxField Key=\"IsoCode\"/><CustomTaxFields/></Tax></Taxes><PaymentMeans><PaymentMean><PaymentMeanField Key=\"PaymentMeanId\">4</PaymentMeanField><PaymentMeanField Key=\"Description\">TC DEBITO</PaymentMeanField><PaymentMeanField Key=\"Type\">0</PaymentMeanField><PaymentMeanField Key=\"LineNumber\">1</PaymentMeanField><PaymentMeanField Key=\"PaymenMeanName\">TC DEBITO</PaymentMeanField><PaymentMeanField Key=\"Amount\">46000,0000</PaymentMeanField><PaymentMeanField Key=\"CurrencyISOCode\">COP</PaymentMeanField><PaymentMeanField Key=\"CurrencyExchangeRate\">1,0000</PaymentMeanField><PaymentMeanField Key=\"TransactionId\"/><PaymentMeanField Key=\"AuthorizationId\"/><PaymentMeanField Key=\"ChargeDiscountType\">0</PaymentMeanField><PaymentMeanField Key=\"ChargeDiscountValue\">0,0000</PaymentMeanField><CustomPaymentMeanFields><CustomPaymentMeanField Key=\"PaymentMeanId\">4</CustomPaymentMeanField><CustomPaymentMeanField Key=\"Version\">28329</CustomPaymentMeanField><CustomPaymentMeanField Key=\"EquivalenciaDIAN\" Required=\"TRUE\">13</CustomPaymentMeanField></CustomPaymentMeanFields><Currency><CurrencyField Key=\"Name\">Peso Colombiano</CurrencyField><CurrencyField Key=\"Initials\">$</CurrencyField><CurrencyField Key=\"InitialsBefore\">true</CurrencyField><CurrencyField Key=\"DecimalCount\">0</CurrencyField><CurrencyField Key=\"IsoCode\">COP</CurrencyField><CustomCurrencyFields/></Currency><CurrencyField Key=\"CurrencyId\">1</CurrencyField></PaymentMean></PaymentMeans><AdditionalFields><AdditionalField Key=\"5000001\">1033650398</AdditionalField><AdditionalField Key=\"5000002\">ANDRES RUEDA</AdditionalField><AdditionalField Key=\"5000003\">cRA 65</AdditionalField><AdditionalField Key=\"5000004\">MEDELLÍN</AdditionalField><AdditionalField Key=\"5000005\">ANTIOQUIA</AdditionalField><AdditionalField Key=\"5000006\">050001</AdditionalField><AdditionalField Key=\"5000007\">3117353447</AdditionalField><AdditionalField Key=\"5000008\">andresrueda@websaas.net</AdditionalField><AdditionalField Key=\"5000009\">Jenny</AdditionalField><AdditionalField Key=\"5000010\">Websaas Developers</AdditionalField><AdditionalField Key=\"5000011\">PRUEBAS WEBSAAS FE</AdditionalField><AdditionalField Key=\"5000012\">900248304</AdditionalField><AdditionalField Key=\"5000013\">Calle 19 No. 43 G 119 Oficina 802</AdditionalField><AdditionalField Key=\"5000014\">MEDELLIN</AdditionalField><AdditionalField Key=\"5000015\">005001</AdditionalField><AdditionalField Key=\"5000016\">developers</AdditionalField><AdditionalField Key=\"5000017\">3164809792</AdditionalField><AdditionalField Key=\"5000018\"/><AdditionalField Key=\"5000019\"/><AdditionalField Key=\"5000020\"/><AdditionalField Key=\"5000021\"/><AdditionalField Key=\"5000022\"/><AdditionalField Key=\"5000023\"/><AdditionalField Key=\"5000024\">0</AdditionalField><AdditionalField Key=\"5000070\">52</AdditionalField><AdditionalField Key=\"5000071\">1</AdditionalField><AdditionalField Key=\"5000072\">1</AdditionalField><AdditionalField Key=\"5000073\">6</AdditionalField><AdditionalField Key=\"5000074\">615</AdditionalField></AdditionalFields></Document>`;

const edition_route = [
    {
        ruta: "Lines.Line.LineField.IsNew",
        label: "Es nuevo",
        editable: false,

    },
    {
        ruta: "Lines.Line.LineField.Name",
        label: "Es nuevo",
        editable: false,

    },
    {
        ruta: "Taxes.Tax.TaxField.Description",
        label: "Es nuevo",
        editable: false
    },
    {
        ruta: "Taxes.Tax.TaxField.TaxBase",
        label: "Es nuevo",
        editable: false
    },
    // {
    //     ruta: "Header.HeaderField.BlockToPrint",
    //     label: "impresion Pagina",
    //     editable: true
    // },
    // {
    //     ruta: "Header.HeaderField.IsoDocumentId",
    //     label: "impresion Pagina",
    //     editable: true
    // },
    // {
    //     ruta: "Header.HeaderField.Alias",
    //     label: "impresion Pagina",
    //     editable: true
    // }

];
var xml_base = new DOMParser().parseFromString(xmlStr, "application/xml").getElementsByTagName("Document")[0];

let bandera = true;
let tamaño_total = 0;
let contador_lineas = 0;

const iterate_xml = (hijos, busqueda, categoria, editable, label) => {
    if (!document.getElementById(`${categoria}`)) {
        crear_padres(categoria);
    }

    Array.from(hijos).forEach((element, index) => {
        let value = isNaN(element.firstChild) ? element.firstChild.nodeValue : "";
        let key = element.attributes.length > 0 ? element.attributes[0].nodeValue : element.localName;

        if (key == busqueda) {
            crear_input_xml(ruta[ruta.length - 2], value, categoria, element, editable, label);
        } else if (hijos.toString() == "[object NodeList]") {
            console.log(hijos);
            Array.from(hijos).forEach((element, index) => {
                if (!document.getElementById(`${categoria}_${index}`)) {
                    let principal_element = document.createElement('div');
                    principal_element.id = `${categoria}_${index}`;
                    principal_element.style.display = "flex";
                    console.log(principal_element);
                    document.getElementById(`${categoria}`).appendChild(principal_element);
                }
            })
            tamaño_total = hijos.length - 1;
            bandera = false;
        }
    });
}

/**
 * 
 * @param {String} categoria  A que padre principal pertenece
 */
const crear_padres = (categoria) => {
    const principal_element = document.createElement('div');
    principal_element.style.marginTop = "30px";
    principal_element.id = categoria;
    principal_element.innerHTML = `<h3 style="margin:0">${categoria}</h3>`;
    document.getElementById('inputs_xml').appendChild(principal_element);
}


/**
 * 
 * @param {String} key_principal Ultimo valor del array de lo cual hace referencia a hijo no padre
 * @param {String} valor_input_xml Valor de la etiqueta del XML
 * @param {String} categoria A que padre principal pertenece
 * @param {HTMLElement} element Elemento que se modifcara
 * @param {Boolean} editable Si se habilita o se deshabilita el input
 */
const crear_input_xml = (key_principal, valor_input_xml, categoria, element, editable, label) => {
    // console.log(key_principal, valor_input_xml, categoria, element, editable, label);
    const div_container = document.createElement("div");
    div_container.classList.add('col-md-3');
    const label_element = document.createElement('label');
    label_element.setAttribute('for', key_principal);
    label_element.innerText = label;
    const br = document.createElement("br");
    const input = document.createElement("input");
    input.type = "text";
    input.disabled = !editable;
    input.setAttribute('value', `${valor_input_xml}`);
    input.placeholder = valor_input_xml;
    input.addEventListener('input', ({ target: { value } }) => modificar_valor(element, value));
    div_container.appendChild(label_element);
    div_container.appendChild(br);
    div_container.appendChild(input);


    if (contador_lineas <= tamaño_total) {
        document.getElementById(`${categoria}_${contador_lineas}`).appendChild(div_container);

        if (contador_lineas == tamaño_total) {
            contador_lineas = 0;
        } else {
            contador_lineas++;
        }
    } else {
        document.getElementById(`${categoria}`).appendChild(div_container);

    }
}
/**
 * 
 * @param {HTMLElement} input_xml Etiqueta de modificacion
 * @param {String} nuevo_valor Valor de cada vez que se escriba en el input
 */
function modificar_valor(input_xml, nuevo_valor) {
    input_xml.firstChild.nodeValue = nuevo_valor;
};


edition_route.forEach(cd_ruta => {
    ruta = cd_ruta.ruta.split(".");
    var padre_hijo = null;
    /**
     * Ciclo que itera los caminos posibles en el XML
     * Con longitud - 1 porque el ultimo valor es el KEY
     */
    for (let index = 0; index < ruta.length - 1; index++) {
        // Si es la primera posicion siempre se toma el valor en [0] (Inicial)
        if (index == 0) {
            padre_hijo = xml_base.getElementsByTagName(`${ruta[index]}`)[0];
            // Sino si se tienen una longitud
        } else if (padre_hijo.attributes?.length == 0) {
            //Se toman los hijos
            padre_hijo = padre_hijo.childNodes;
            //Si no se tienen atributos
            if (!padre_hijo?.attributes) {
                /**
                 * Estan listos para imprimirsen y no hay mas profundidad
                 * se envia el ultimo valor de la ruta el cual es el KEY
                 */
                iterate_xml(padre_hijo, ruta[index + 1], ruta[0], cd_ruta.editable, cd_ruta.label);
            }
            //Sino si no hay atributos
        } else if (!padre_hijo?.attributes) {
            /**
             * Se hace la iteraccion por cada uno de los
             * hijos del padre
             */
            Array.from(padre_hijo).forEach(element_2 => {

                padre_hijo = element_2.getElementsByTagName(`${ruta[index]}`);
                /**
                 * Estan listos para imprimirsen y no hay mas profundidad
                 * se envia el ultimo valor de la ruta el cual es el KEY
                 */
                iterate_xml(padre_hijo, ruta[index + 1], ruta[0], cd_ruta.editable, cd_ruta.label);
            })
        }
    }
});
